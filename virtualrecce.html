<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Virtual Reconnaissance: Location Scout</title>
    
    <!-- React & Tailwind Setup -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Library for saving images -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Cinzel:wght@400;700&family=Patrick+Hand&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #fdfbf7; /* Cream background */
            font-family: 'Patrick Hand', cursive;
            color: #234f32; /* Hunter Green */
        }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .font-hand { font-family: 'Patrick Hand', cursive; }
        .font-marker { font-family: 'Architects Daughter', cursive; }
        .font-barcode { font-family: 'Libre Barcode 39 Text', cursive; }
        
        .theme-green { color: #234f32; }
        .bg-theme-green { background-color: #234f32; }
        .theme-gold { color: #c5a009; }
        .bg-theme-gold { background-color: #c5a009; }
        .border-theme-gold { border-color: #c5a009; }
        
        .notebook-tab {
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
        }

        .animate-stamp {
            animation: stamp 0.5s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards;
            opacity: 0;
            transform: scale(2) rotate(-15deg);
        }
        
        @keyframes stamp {
            0% { opacity: 0; transform: scale(3) rotate(-15deg); }
            100% { opacity: 1; transform: scale(1) rotate(-15deg); }
        }

        /* Certificate Pattern */
        .cert-pattern {
            background-image: radial-gradient(#c5a009 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATA ---
        const missions = [
            {
                id: 'fukushima',
                title: 'Zone 0: Fukushima',
                brief: 'Target Zone. Gather general info on the region.',
                questions: [
                    { q: "Fukushima is the gateway to which region?", options: ["Kanto", "Tohoku", "Kansai", "Hokkaido"], answer: "Tohoku" },
                    { q: "What is the famous 'Red Cow' toy called?", options: ["Akabeko", "Kurobeko", "Wagyu", "Ushi-san"], answer: "Akabeko" },
                    { q: "Fukushima is famous for which fruit?", options: ["Bananas", "Peaches", "Pineapples", "Durian"], answer: "Peaches" }
                ],
                reward: {
                    target: "The Akabeko Shot",
                    note: "If you see an Akabeko, film a close-up of its head bobbing. It makes for a great cute transition!"
                }
            },
            {
                id: 'britishhills',
                title: 'Zone 1: British Hills',
                brief: 'The Base. Investigate the rules of the English Village.',
                questions: [
                    { q: "Is British Hills medieval or modern style?", options: ["Modern", "Futuristic", "Medieval", "Cyberpunk"], answer: "Medieval" },
                    { q: "Which activity can you do here?", options: ["Cooking Scones", "Playing Cricket", "Afternoon Tea", "All of them"], answer: "All of them" },
                    { q: "What language should you use?", options: ["Japanese", "French", "English", "Klingon"], answer: "English" }
                ],
                reward: {
                    target: "The Medieval Britain Vibe",
                    note: "The refectory is beautiful. Film a slow 'Pan' across the room when it‚Äôs quiet!"
                }
            },
            {
                id: 'ouchijuku',
                title: 'Zone 2: Ouchijuku',
                brief: 'The Time Capsule. Identify key visual hooks.',
                questions: [
                    { q: "The houses here have what kind of roof?", options: ["Tile", "Metal", "Thatched/Straw", "Glass"], answer: "Thatched/Straw" },
                    { q: "What do you use to eat Negi Soba?", options: ["A Fork", "A Leek", "A Straw", "Your Hands"], answer: "A Leek" },
                    { q: "This town was a post station on which road?", options: ["Route 66", "Silk Road", "Aizu-Nishi Kaido", "Tokaido"], answer: "Aizu-Nishi Kaido" }
                ],
                reward: {
                    target: "The Food Reaction",
                    note: "Try filming your teammate trying to eat noodles with a leek. Capture their reaction!"
                }
            },
            {
                id: 'aizu',
                title: 'Zone 3: Aizu-Wakamatsu',
                brief: 'The Fortress. Focus on history and color.',
                questions: [
                    { q: "What color are Tsurugajou's roof tiles?", options: ["Blue", "Red/Reddish-brown", "Green", "Black"], answer: "Red/Reddish-brown" },
                    { q: "Name the group of young samurai tigers.", options: ["Shinsengumi", "Byakkotai", "Power Rangers", "Samurai Blue"], answer: "Byakkotai" },
                    { q: "Name the rising priest doll.", options: ["Kokeshi", "Okiagari-Koboshi", "Daruma", "Barbie"], answer: "Okiagari-Koboshi" }
                ],
                reward: {
                    target: "The Samurai Spirit",
                    note: "The red tiles look amazing against a blue sky. Use a 'Low Angle' shot to make the castle look powerful."
                }
            },
            {
                id: 'inawashiro',
                title: 'Zone 4: Inawashiro',
                brief: 'The Mirror. Connect nature and science.',
                questions: [
                    { q: "Which famous doctor was born here?", options: ["Hideyo Noguchi", "Ken Watanabe", "Mario", "Tezuka Osamu"], answer: "Hideyo Noguchi" },
                    { q: "Lake Inawashiro's nickname is ______ Lake.", options: ["Muddy", "Heavenly Mirror", "Loch Ness", "Blue Giant"], answer: "Heavenly Mirror" },
                    { q: "What birds migrate here in winter?", options: ["Penguins", "Flamingos", "Swans", "Pigeons"], answer: "Swans" }
                ],
                reward: {
                    target: "The Reflective Shot",
                    note: "Get your camera close to the water surface to capture the reflection of the mountain. It‚Äôs movie magic!"
                }
            }
        ];

        // --- COMPONENTS ---

        const App = () => {
            const [scoutName, setScoutName] = useState('');
            const [view, setView] = useState('login'); // login, dashboard, mission, reward, complete
            const [completedMissions, setCompletedMissions] = useState([]);
            const [currentMissionId, setCurrentMissionId] = useState(null);
            const [quizIndex, setQuizIndex] = useState(0);
            
            // Initial load
            useEffect(() => {
                const savedName = localStorage.getItem('scout_name');
                const savedProgress = JSON.parse(localStorage.getItem('scout_progress') || '[]');
                if (savedName) setScoutName(savedName);
                if (savedProgress) setCompletedMissions(savedProgress);
            }, []);

            // Save progress
            useEffect(() => {
                localStorage.setItem('scout_name', scoutName);
                localStorage.setItem('scout_progress', JSON.stringify(completedMissions));
            }, [scoutName, completedMissions]);

            const startMission = (id) => {
                setCurrentMissionId(id);
                setQuizIndex(0);
                setView('mission');
            };

            const replayMission = () => {
                setQuizIndex(0);
                setView('mission');
            };

            const handleFolderClick = (m, isLocked, isComplete) => {
                if (isLocked) return;
                
                if (isComplete) {
                    // If complete, show the reward/info screen (where they can also retake quiz)
                    setCurrentMissionId(m.id);
                    setView('reward');
                } else {
                    // If not complete, start the quiz
                    startMission(m.id);
                }
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if(scoutName.trim()) setView('dashboard');
            };

            const handleAnswer = (option, correct) => {
                if (option === correct) {
                    const mission = missions.find(m => m.id === currentMissionId);
                    if (quizIndex < mission.questions.length - 1) {
                        setQuizIndex(quizIndex + 1);
                    } else {
                        // Mission Complete
                        if (!completedMissions.includes(currentMissionId)) {
                            setCompletedMissions([...completedMissions, currentMissionId]);
                        }
                        setView('reward');
                    }
                } else {
                    alert("‚ö†Ô∏è Research Incorrect. Try again!");
                }
            };
            
            const handleSavePhoto = () => {
                const element = document.getElementById('certificate-card');
                if (window.html2canvas) {
                    // Add temporary class to ensure clean capture
                    element.style.transform = "scale(1)"; 
                    
                    window.html2canvas(element, { 
                        scale: 3, // High resolution
                        backgroundColor: null,
                        useCORS: true 
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `Scout_Certificate_${scoutName.replace(/\s+/g, '_')}.png`;
                        link.href = canvas.toDataURL("image/png");
                        link.click();
                    }).catch(err => {
                        console.error(err);
                        alert("Auto-save failed. Please take a screenshot manually!");
                    });
                } else {
                    alert("Please take a screenshot of your certificate manually.");
                }
            };

            const getProgress = () => {
                return Math.round((completedMissions.length / missions.length) * 100);
            };

            // --- VIEWS ---

            if (view === 'login') return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded shadow-2xl max-w-md w-full border-t-8 border-theme-gold transform rotate-1">
                        <div className="text-center mb-6">
                            <span className="text-6xl">üìù</span>
                        </div>
                        <h1 className="text-3xl font-cinzel text-center font-bold mb-2 text-theme-green">Production Team</h1>
                        <p className="text-center text-gray-500 mb-6 font-marker">Log in to start planning.</p>
                        <form onSubmit={handleLogin}>
                            <label className="block font-bold mb-2 text-theme-green">CREATOR NAME:</label>
                            <input 
                                type="text" 
                                value={scoutName}
                                onChange={e => setScoutName(e.target.value)}
                                className="w-full bg-[#fdfbf7] border-2 border-theme-gold p-3 font-hand text-xl mb-4 focus:outline-none focus:border-theme-green rounded"
                                placeholder="Enter Name..."
                            />
                            <button className="w-full bg-theme-green text-white font-cinzel font-bold py-3 hover:bg-[#1a3b25] transition-colors rounded">
                                START SCOUTING
                            </button>
                        </form>
                    </div>
                </div>
            );

            if (view === 'dashboard') return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <div className="bg-white p-4 border-b border-theme-gold flex justify-between items-center sticky top-0 z-30 shadow-lg">
                        <div>
                            <div className="text-xs text-gray-400 font-cinzel">SCOUT: {scoutName}</div>
                            <div className="font-cinzel font-bold text-lg text-theme-green">SCOUTING PROGRESS</div>
                        </div>
                        <div className="text-3xl font-bold font-marker text-theme-gold">{getProgress()}%</div>
                    </div>
                    
                    {/* Meter Bar */}
                    <div className="w-full bg-gray-200 h-4 sticky top-[73px] z-30">
                        <div 
                            className="bg-theme-green h-4 transition-all duration-1000 ease-out" 
                            style={{ width: `${getProgress()}%` }}
                        ></div>
                    </div>

                    {/* Mission Grid */}
                    <div className="max-w-md mx-auto p-6 space-y-6">
                        {missions.map((m, idx) => {
                            const isComplete = completedMissions.includes(m.id);
                            const isLocked = idx > 0 && !completedMissions.includes(missions[idx-1].id);
                            
                            return (
                                <button 
                                    key={m.id}
                                    onClick={() => handleFolderClick(m, isLocked, isComplete)}
                                    disabled={isLocked}
                                    className={`w-full text-left relative group transition-all duration-300 ${isLocked ? 'opacity-100' : 'hover:scale-[1.02]'}`}
                                >
                                    {/* Folder Tab Look */}
                                    <div className={`w-32 h-6 rounded-t-lg mx-auto relative z-10 notebook-tab ${isComplete ? 'bg-theme-green' : isLocked ? 'bg-gray-400' : 'bg-theme-gold'}`}>
                                    </div>
                                    
                                    {/* Main File Body */}
                                    <div className={`p-6 rounded-lg shadow-lg relative overflow-hidden border-2 ${isComplete ? 'bg-[#f0f0f0] border-theme-green' : isLocked ? 'bg-gray-100 border-gray-300' : 'bg-white border-theme-gold'}`}>
                                        
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h3 className={`font-cinzel font-bold text-xl ${isLocked ? 'text-gray-400' : 'theme-green'}`}>{m.title}</h3>
                                                <p className={`font-hand text-lg mt-1 ${isLocked ? 'text-gray-400' : 'text-gray-600'}`}>
                                                    {isLocked ? "Complete previous location to unlock." : m.brief}
                                                </p>
                                            </div>
                                            <div className="text-2xl">
                                                {isLocked ? 'üîí' : isComplete ? '‚úÖ' : 'üìç'}
                                            </div>
                                        </div>

                                        {isComplete && (
                                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 border-4 border-theme-green text-theme-green font-bold text-2xl p-2 rounded animate-stamp opacity-50 rotate-[-15deg] whitespace-nowrap pointer-events-none font-marker">
                                                SCOUTED
                                            </div>
                                        )}
                                    </div>
                                </button>
                            );
                        })}

                        {/* Final Certification / ID CARD */}
                        {getProgress() === 100 && (
                            <div className="text-center mt-12 animate-fade-in pb-10">
                                
                                <div className="mb-4 text-theme-green font-cinzel font-bold">‚ñº CERTIFICATION OBTAINED ‚ñº</div>

                                {/* CERTIFICATE CONTAINER */}
                                <div id="certificate-card" className="bg-white w-full max-w-[600px] mx-auto p-8 rounded shadow-2xl relative overflow-hidden flex flex-col items-center justify-center border-8 border-double border-theme-gold cert-pattern">
                                    
                                    {/* Decorative Corner */}
                                    <div className="absolute top-0 left-0 w-16 h-16 border-t-8 border-l-8 border-theme-green"></div>
                                    <div className="absolute top-0 right-0 w-16 h-16 border-t-8 border-r-8 border-theme-green"></div>
                                    <div className="absolute bottom-0 left-0 w-16 h-16 border-b-8 border-l-8 border-theme-green"></div>
                                    <div className="absolute bottom-0 right-0 w-16 h-16 border-b-8 border-r-8 border-theme-green"></div>

                                    {/* Logo */}
                                    <img 
                                        src="https://www.enjoybritish-hills.com/uploads/6/4/2/6/64269063/1466432519.png" 
                                        alt="British Hills Logo" 
                                        className="h-20 mb-6 object-contain"
                                        crossOrigin="anonymous"
                                    />

                                    {/* Title */}
                                    <h2 className="text-2xl md:text-3xl font-cinzel font-bold text-theme-green mb-2 tracking-wide uppercase">
                                        Location Preparation
                                    </h2>
                                    <h2 className="text-xl md:text-2xl font-cinzel font-bold text-theme-gold mb-6 tracking-widest uppercase">
                                        Completion Certificate
                                    </h2>

                                    {/* Text Body */}
                                    <p className="font-hand text-xl text-gray-600 mb-2">This certifies that</p>
                                    
                                    <div className="text-4xl font-marker text-black border-b-2 border-gray-300 px-8 py-2 mb-4 w-full text-center">
                                        {scoutName}
                                    </div>

                                    <p className="font-hand text-lg text-gray-600 mb-8 max-w-sm mx-auto leading-relaxed">
                                        Has successfully scouted all designated zones for the British Hills Summer Camp Project.
                                    </p>

                                    {/* Signature / Date */}
                                    <div className="flex justify-between items-end w-full max-w-xs text-center md:px-8">
                                        <div className="flex flex-col items-center">
                                            <div className="font-marker text-theme-green text-xl mb-1">British Hills Education</div>
                                            <div className="w-32 border-t border-gray-400 text-xs font-cinzel text-gray-400 pt-1">AUTHORIZED BY</div>
                                        </div>
                                        <div className="mb-2">
                                            <div className="border-2 border-theme-green text-theme-green font-bold px-3 py-1 rounded rotate-[-12deg] opacity-80 uppercase tracking-widest font-cinzel text-xs">
                                                Verified
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Controls */}
                                <button onClick={handleSavePhoto} className="mt-8 w-full max-w-sm bg-theme-green text-white px-6 py-4 rounded font-bold hover:bg-[#1a3b25] font-cinzel shadow-lg flex items-center justify-center gap-2 text-lg mx-auto">
                                    üì∏ DOWNLOAD CERTIFICATE
                                </button>
                                <p className="text-gray-400 text-sm mt-2 italic">(Or screenshot this certificate!)</p>
                                
                                <div className="mt-6 border-t border-gray-200 pt-6">
                                     <a href="index.html" className="text-gray-400 hover:text-theme-green underline font-hand text-lg">Return to Hub</a>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );

            if (view === 'mission') {
                const mission = missions.find(m => m.id === currentMissionId);
                const currentQ = mission.questions[quizIndex];

                return (
                    <div className="min-h-screen flex items-center justify-center p-4">
                        <div className="bg-white text-gray-900 p-6 rounded shadow-xl max-w-md w-full border-t-4 border-theme-gold">
                            <div className="flex justify-between items-center mb-6 border-b border-gray-200 pb-2">
                                <span className="font-cinzel text-sm text-gray-400">SCOUTING LOCATION...</span>
                                <span className="font-bold text-theme-green">{quizIndex + 1} / {mission.questions.length}</span>
                            </div>

                            <h3 className="text-xl font-bold font-marker mb-6 leading-relaxed theme-green">
                                {currentQ.q}
                            </h3>

                            <div className="space-y-3">
                                {currentQ.options.sort(() => Math.random() - 0.5).map((opt, i) => (
                                    <button
                                        key={i}
                                        onClick={() => handleAnswer(opt, currentQ.answer)}
                                        className="w-full text-left p-4 border-2 border-gray-100 hover:border-theme-gold hover:bg-[#fffbef] transition-colors font-hand text-xl rounded text-gray-700"
                                    >
                                        {opt}
                                    </button>
                                ))}
                            </div>
                            
                            <button onClick={() => setView('dashboard')} className="mt-6 text-gray-400 text-sm hover:text-black font-cinzel">
                                ‚Üê BACK TO MAP
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'reward') {
                const mission = missions.find(m => m.id === currentMissionId);
                return (
                    <div className="min-h-screen bg-theme-green flex items-center justify-center p-4 text-center">
                        <div className="bg-white p-8 rounded shadow-2xl max-w-md w-full border-4 border-theme-gold relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-2 bg-theme-gold"></div>
                            
                            <div className="text-6xl mb-4">üéâ</div>
                            <h2 className="text-3xl font-cinzel font-bold text-theme-green mb-2">LOCATION SCOUTED!</h2>
                            <p className="text-gray-500 font-hand text-xl mb-6">Research Complete.</p>

                            <div className="bg-[#fdfbf7] p-4 rounded border-l-4 border-theme-gold text-left mb-6">
                                <div className="text-xs font-bold text-gray-400 mb-1 uppercase font-cinzel">Visual Target Unlocked:</div>
                                <div className="text-xl font-bold theme-green font-marker mb-2">{mission.reward.target}</div>
                                <div className="text-lg font-hand text-gray-600 italic">"{mission.reward.note}"</div>
                            </div>

                            <div className="space-y-3">
                                <button 
                                    onClick={() => setView('dashboard')}
                                    className="w-full bg-theme-green text-white font-bold py-3 rounded hover:bg-[#1a3b25] transition-colors font-cinzel"
                                >
                                    RETURN TO MAP
                                </button>
                                <button 
                                    onClick={replayMission}
                                    className="w-full bg-white text-theme-green border-2 border-theme-green font-bold py-3 rounded hover:bg-[#f0f9f4] transition-colors font-cinzel"
                                >
                                    TAKE QUIZ AGAIN
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
